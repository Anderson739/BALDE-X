<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Free Fire JS Edition</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Arial Black', sans-serif; user-select: none; }
        canvas { display: block; }

        /* Interface HUD */
        #hud { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        
        #stats { position: absolute; top: 20px; left: 20px; color: white; text-shadow: 2px 2px #000; }
        #zone-timer { position: absolute; top: 20px; right: 20px; color: #ffeb3b; font-size: 24px; text-align: right; }
        
        #health-container { position: absolute; bottom: 40px; left: 50%; transform: translateX(-50%); width: 250px; }
        #hp-bar { width: 100%; height: 12px; background: rgba(0,0,0,0.6); border: 2px solid #fff; border-radius: 5px; overflow: hidden; }
        #hp-fill { width: 100%; height: 100%; background: #2ecc71; transition: width 0.2s; }
        #ep-bar { width: 100%; height: 6px; background: rgba(0,0,0,0.6); border: 1px solid #fff; margin-top: 4px; }
        #ep-fill { width: 40%; height: 100%; background: #f1c40f; }

        /* Contrôles Mobile */
        .btn { pointer-events: auto; position: absolute; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; border: 2px solid rgba(255,255,255,0.5); }
        #joy-base { bottom: 50px; left: 50px; width: 120px; height: 120px; }
        #joy-stick { width: 50px; height: 50px; background: #fff; border-radius: 50%; }
        #btn-shoot { bottom: 60px; right: 40px; width: 90px; height: 90px; background: rgba(255,0,0,0.5); font-size: 20px; }
        #btn-jump { bottom: 160px; right: 40px; width: 60px; height: 60px; }
        #btn-crouch { bottom: 60px; right: 150px; width: 60px; height: 60px; }

        /* Menu */
        #overlay { position: absolute; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 100; color: white; }
        button#start-btn { padding: 20px 50px; font-size: 24px; background: #f39c12; color: white; border: none; border-radius: 10px; cursor: pointer; }
    </style>
</head>
<body>

    <div id="overlay">
        <h1>FREE FIRE JS</h1>
        <p>Modification 1, 2, 9, 15, 69, 150 activées</p>
        <button id="start-btn">LANCER LE MATCH</button>
    </div>

    <div id="hud">
        <div id="stats">KILLS: <span id="kill-count">0</span> | ALIVE: <span id="alive-count">10</span></div>
        <div id="zone-timer">LA ZONE ARRIVE<br><span id="timer-val">02:00</span></div>
        
        <div id="health-container">
            <div id="ep-bar"><div id="ep-fill"></div></div>
            <div id="hp-bar"><div id="hp-fill"></div></div>
        </div>

        <div id="joy-base" class="btn"><div id="joy-stick"></div></div>
        <div id="btn-shoot" class="btn">FEU</div>
        <div id="btn-jump" class="btn">SAUT</div>
        <div id="btn-crouch" class="btn">ACC.</div>
    </div>

    <script type="importmap">
        { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js" } }
    </script>

    <script type="module">
        import * as THREE from 'three';

        // --- CONFIG & AUDIO (38, 119) ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSynthSound(type) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain); gain.connect(audioCtx.destination);
            if(type === 'shoot') {
                osc.type = 'square'; osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            } else if(type === 'hit') {
                osc.type = 'sawtooth'; osc.frequency.setValueAtTime(100, audioCtx.currentTime);
                gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
                gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.1);
            }
            osc.start(); osc.stop(audioCtx.currentTime + 0.1);
        }

        // --- VARIABLES GLOBALES ---
        let scene, camera, renderer, clock, player;
        let enemies = [], bullets = [], loots = [];
        let moveDir = { x: 0, z: 0 };
        let isJumping = false, vVel = 0;
        let hp = 100, zoneRadius = 150, kills = 0;
        let isGameRunning = false;

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB);
            scene.fog = new THREE.Fog(0x87CEEB, 20, 150);

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            document.body.appendChild(renderer.domElement);

            // Lumières (26)
            const sun = new THREE.DirectionalLight(0xffffff, 1.2);
            sun.position.set(50, 100, 50);
            sun.castShadow = true;
            scene.add(sun);
            scene.add(new THREE.AmbientLight(0x404040));

            // Sol (2, 4)
            const floor = new THREE.Mesh(new THREE.PlaneGeometry(500, 500), new THREE.MeshStandardMaterial({ color: 0x27ae60 }));
            floor.rotation.x = -Math.PI / 2;
            floor.receiveShadow = true;
            scene.add(floor);

            // Création Joueur (Forme Humaine 3D)
            player = new THREE.Group();
            const body = new THREE.Mesh(new THREE.CapsuleGeometry(0.4, 1, 4, 8), new THREE.MeshStandardMaterial({ color: 0x3498db }));
            body.position.y = 1;
            const head = new THREE.Mesh(new THREE.SphereGeometry(0.25), new THREE.MeshStandardMaterial({ color: 0xffdbac }));
            head.position.y = 1.8;
            player.add(body, head);
            player.position.set(0, 0, 0);
            scene.add(player);

            // Zone de sécurité (1)
            const zoneGeo = new THREE.CylinderGeometry(1, 1, 100, 64, 1, true);
            const zoneMat = new THREE.MeshBasicMaterial({ color: 0x0000ff, transparent: true, opacity: 0.2, side: THREE.DoubleSide });
            const zone = new THREE.Mesh(zoneGeo, zoneMat);
            zone.name = "dangerZone";
            scene.add(zone);

            // Spawn Ennemis (Bots 91, 104)
            for(let i=0; i<10; i++) spawnBot();

            // Spawn Loot (15)
            for(let i=0; i<20; i++) {
                const box = new THREE.Mesh(new THREE.BoxGeometry(0.5,0.5,0.5), new THREE.MeshStandardMaterial({color: 0xff0000}));
                box.position.set(Math.random()*200-100, 0.25, Math.random()*200-100);
                scene.add(box);
                loots.push(box);
            }

            setupControls();
            clock = new THREE.Clock();
            animate();
        }

        function spawnBot() {
            const bot = new THREE.Group();
            const body = new THREE.Mesh(new THREE.CapsuleGeometry(0.4, 1, 4, 8), new THREE.MeshStandardMaterial({ color: 0xe74c3c }));
            body.position.y = 1;
            bot.add(body);
            bot.position.set(Math.random()*200-100, 0, Math.random()*200-100);
            bot.userData = { health: 100, targetDir: new THREE.Vector3(Math.random()-0.5, 0, Math.random()-0.5) };
            scene.add(bot);
            enemies.push(bot);
        }

        function shoot() {
            playSynthSound('shoot');
            const b = new THREE.Mesh(new THREE.SphereGeometry(0.1), new THREE.MeshBasicMaterial({ color: 0xffff00 }));
            b.position.copy(player.position);
            b.position.y = 1.5;
            const dir = new THREE.Vector3(0, 0, -1).applyQuaternion(player.quaternion);
            b.userData.velocity = dir.multiplyScalar(1.2);
            scene.add(b);
            bullets.push(b);
        }

        function setupControls() {
            // Joystick simple (90)
            const joyBase = document.getElementById('joy-base');
            const joyStick = document.getElementById('joy-stick');
            
            joyBase.addEventListener('touchmove', (e) => {
                const touch = e.touches[0];
                const rect = joyBase.getBoundingClientRect();
                const dx = (touch.clientX - (rect.left + 60)) / 60;
                const dz = (touch.clientY - (rect.top + 60)) / 60;
                moveDir.x = Math.max(-1, Math.min(1, dx));
                moveDir.z = Math.max(-1, Math.min(1, dz));
                joyStick.style.transform = `translate(${moveDir.x*30}px, ${moveDir.z*30}px)`;
            });

            joyBase.addEventListener('touchend', () => {
                moveDir = { x: 0, z: 0 };
                joyStick.style.transform = `translate(0,0)`;
            });

            document.getElementById('btn-shoot').onclick = () => shoot();
            document.getElementById('btn-jump').onclick = () => { if(!isJumping) { vVel = 0.2; isJumping = true; } };
        }

        function animate() {
            if(!isGameRunning) return;
            requestAnimationFrame(animate);
            const delta = clock.getDelta();

            // Mouvement Joueur
            if(Math.abs(moveDir.x) > 0.1 || Math.abs(moveDir.z) > 0.1) {
                player.rotation.y -= moveDir.x * 0.05;
                player.translateZ(-moveDir.z * 0.15);
            }

            // Saut (9, 62)
            if(isJumping) {
                player.position.y += vVel;
                vVel -= 0.01;
                if(player.position.y <= 0) { player.position.y = 0; isJumping = false; }
            }

            // Caméra TPP (75)
            const camOffset = new THREE.Vector3(0, 3, 6).applyQuaternion(player.quaternion);
            camera.position.lerp(player.position.clone().add(camOffset), 0.1);
            camera.lookAt(player.position.clone().add(new THREE.Vector3(0,1.5,0)));

            // Gestion des Balles (47)
            bullets.forEach((b, i) => {
                b.position.add(b.userData.velocity);
                enemies.forEach((en, ei) => {
                    if(b.position.distanceTo(en.position) < 1) {
                        playSynthSound('hit');
                        scene.remove(en);
                        enemies.splice(ei, 1);
                        kills++;
                        document.getElementById('kill-count').innerText = kills;
                        document.getElementById('alive-count').innerText = enemies.length;
                    }
                });
            });

            // Gestion de la Zone (1, 150)
            zoneRadius -= 0.02;
            const zoneObj = scene.getObjectByName("dangerZone");
            zoneObj.scale.set(zoneRadius, 1, zoneRadius);
            
            if(player.position.distanceTo(new THREE.Vector3(0,0,0)) > zoneRadius) {
                hp -= 0.05;
                document.getElementById('hp-fill').style.width = hp + "%";
                if(hp <= 0) alert("ELIMINÉ PAR LA ZONE !");
            }

            renderer.render(scene, camera);
        }

        document.getElementById('start-btn').onclick = () => {
            audioCtx.resume();
            document.getElementById('overlay').style.display = 'none';
            isGameRunning = true;
            init();
        };

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
